version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies..."
        - npm install
    build:
      commands:
        - echo "Building web app with Expo..."
        - npm run build
        - echo "Build completed"
        - echo "Creating required files for Amplify..."
        - |
          if [ -f "dist/swelly_chat.html" ]; then
            cp dist/swelly_chat.html dist/index.html
            echo "Created index.html from swelly_chat.html"
          fi
        - echo '{}' > dist/required-server-files.json
        - echo "Created required-server-files.json"
        - printf '{"version": 1, "routes": []}\n' > dist/server-trace.json
        - echo "Created server-trace.json (empty for static site)"
        - echo "Verifying build output..."
        - ls -la dist/ | head -10
        - test -f dist/index.html && echo "✓ index.html exists" || echo "✗ index.html missing"
        - test -f dist/required-server-files.json && echo "✓ required-server-files.json exists" || echo "✗ required-server-files.json missing"
        - test -f dist/server-trace.json && echo "✓ server-trace.json exists" || echo "✗ server-trace.json missing"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
